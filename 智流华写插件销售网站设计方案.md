# æ™ºæµåå†™æ’ä»¶é”€å”®ç½‘ç«™è®¾è®¡æ–¹æ¡ˆ

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

### äº§å“å®šä½
- **äº§å“åç§°**ï¼šæ™ºæµåå†™ - Chromeæµè§ˆå™¨æ“ä½œå½•åˆ¶æ’ä»¶
- **ç›®æ ‡ç”¨æˆ·**ï¼šä¼ä¸šåŸ¹è®­å¸ˆã€äº§å“ç»ç†ã€æŠ€æœ¯æ–‡æ¡£ç¼–å†™è€…ã€å®¢æœäººå‘˜
- **æ ¸å¿ƒä»·å€¼**ï¼šè‡ªåŠ¨åŒ–æ“ä½œæµç¨‹è®°å½•ï¼Œä¸€é”®ç”Ÿæˆä¸“ä¸šæ“ä½œæ–‡æ¡£

### å•†ä¸šæ¨¡å¼
- **å…è´¹ç‰ˆ**ï¼šé™åˆ¶20é¡µæˆªå›¾ï¼Œåªèƒ½å¯¼å‡ºPDFæ–‡ä»¶
- **ä»˜è´¹ç‰ˆ**ï¼š49å…ƒ/å¹´ï¼Œæ— é™åˆ¶ä½¿ç”¨ï¼Œæ”¯æŒå¯¼å‡ºMDæ–‡ä»¶
- **ç»­è´¹ç­–ç•¥**ï¼šåˆ°æœŸå‰30å¤©å¼€å§‹æé†’ï¼Œæ”¯æŒè‡ªåŠ¨ç»­è´¹
- **æ”¯ä»˜æ–¹å¼**ï¼šå¾®ä¿¡æ‰«ç æ”¯ä»˜ï¼Œæ”¯æŒè‡ªåŠ¨æ‰£è´¹
- **æˆæƒéªŒè¯**ï¼šåœ¨çº¿éªŒè¯ç³»ç»Ÿï¼Œå®æ—¶æ£€æŸ¥åˆ°æœŸçŠ¶æ€

---

## ğŸŒ ç½‘ç«™æ¶æ„è®¾è®¡

### 1. é¦–é¡µ (Landing Page)
```
æ™ºæµåå†™ - è®©æ“ä½œè®°å½•å˜å¾—ç®€å•
[Hero Section]
- ä¸»æ ‡é¢˜ï¼šæ™ºæµåå†™ - ä¸“ä¸šçš„æ“ä½œæµç¨‹è®°å½•å·¥å…·
- å‰¯æ ‡é¢˜ï¼šä¸€é”®å½•åˆ¶ï¼Œè‡ªåŠ¨æˆªå›¾ï¼Œæ™ºèƒ½ç”Ÿæˆæ“ä½œæ–‡æ¡£
- CTAæŒ‰é’®ï¼š[å…è´¹è¯•ç”¨] [ç«‹å³è´­ä¹°]
- äº§å“æ¼”ç¤ºè§†é¢‘/GIF

[åŠŸèƒ½ç‰¹è‰²]
âœ… è‡ªåŠ¨æˆªå›¾è®°å½•
âœ… æ™ºèƒ½ç‚¹å‡»è·Ÿè¸ª  
âœ… ä¸€é”®å¯¼å‡ºæ–‡æ¡£
âœ… æ”¯æŒæ‰€æœ‰ç½‘ç«™
âœ… æ“ä½œç®€å•æ˜“ç”¨
âœ… ä¸“ä¸šæ–‡æ¡£è¾“å‡º

[ä½¿ç”¨åœºæ™¯]
ğŸ“‹ ä¼ä¸šåŸ¹è®­æ–‡æ¡£åˆ¶ä½œ
ğŸ“‹ äº§å“æ“ä½œè¯´æ˜ç¼–å†™
ğŸ“‹ å®¢æœæµç¨‹æ ‡å‡†åŒ–
ğŸ“‹ æŠ€æœ¯æ–‡æ¡£å¿«é€Ÿç”Ÿæˆ

[ä»·æ ¼æ–¹æ¡ˆ]
å…è´¹ç‰ˆ vs ä¸“ä¸šç‰ˆå¯¹æ¯”è¡¨
```

### 2. äº§å“åŠŸèƒ½é¡µé¢
```
[æ ¸å¿ƒåŠŸèƒ½å±•ç¤º]
- åŠŸèƒ½1ï¼šæ™ºèƒ½æˆªå›¾ - è‡ªåŠ¨æ•è·å…³é”®æ“ä½œæ­¥éª¤
- åŠŸèƒ½2ï¼šç‚¹å‡»è·Ÿè¸ª - ç²¾å‡†æ ‡è®°ç”¨æˆ·æ“ä½œä½ç½®
- åŠŸèƒ½3ï¼šæ–‡æ¡£ç”Ÿæˆ - ä¸€é”®å¯¼å‡ºä¸“ä¸šMarkdownæ–‡æ¡£
- åŠŸèƒ½4ï¼šå¤šåœºæ™¯æ”¯æŒ - é€‚ç”¨äºå„ç±»ç½‘ç«™å’Œç³»ç»Ÿ

[æŠ€æœ¯ä¼˜åŠ¿]
- Chromeæ’ä»¶æŠ€æœ¯ï¼Œå…¼å®¹æ€§å¼º
- æœ¬åœ°å¤„ç†ï¼Œæ•°æ®å®‰å…¨
- è½»é‡çº§è®¾è®¡ï¼Œä¸å½±å“æµè§ˆé€Ÿåº¦
- æ™ºèƒ½è¯†åˆ«ï¼Œå‡å°‘æ‰‹åŠ¨æ“ä½œ
```

### 3. å®šä»·é¡µé¢
```
[å®šä»·ç­–ç•¥]
å…è´¹ç‰ˆï¼š
- âœ… åŸºç¡€å½•åˆ¶åŠŸèƒ½
- âœ… 20é¡µæˆªå›¾é™åˆ¶
- âœ… ä»…æ”¯æŒPDFå¯¼å‡º
- âŒ æ— æŠ€æœ¯æ”¯æŒ
- âŒ ä¸æ”¯æŒMDæ ¼å¼

ä¸“ä¸šç‰ˆ - Â¥49/å¹´ï¼š
- âœ… æ— é™åˆ¶å½•åˆ¶
- âœ… æ— é™æˆªå›¾æ•°é‡
- âœ… æ”¯æŒPDF + MDå¯¼å‡º
- âœ… ä¼˜å…ˆæŠ€æœ¯æ”¯æŒ
- âœ… å®šæœŸåŠŸèƒ½æ›´æ–°
- âœ… å•†ä¸šä½¿ç”¨æˆæƒ

[æ”¯ä»˜æ–¹å¼]
- å¾®ä¿¡æ‰«ç æ”¯ä»˜
- æ”¯ä»˜å®æ”¯ä»˜
- é“¶è¡Œå¡æ”¯ä»˜
```

### 4. ç”¨æˆ·ä¸­å¿ƒ
```
[ç™»å½•æ–¹å¼]
- å¾®ä¿¡æ‰«ç ç™»å½•ï¼ˆå”¯ä¸€ç™»å½•æ–¹å¼ï¼‰

[ç”¨æˆ·é¢æ¿]
- ä¸ªäººä¿¡æ¯
- è®¢é˜…çŠ¶æ€
- ä½¿ç”¨ç»Ÿè®¡
- æˆæƒç®¡ç†
- å‘ç¥¨ç”³è¯·
```

---

## ğŸ” æˆæƒç³»ç»Ÿè®¾è®¡

### 1. ç”¨æˆ·è®¤è¯æµç¨‹
```
1. ç”¨æˆ·è®¿é—®ç½‘ç«™
2. å¾®ä¿¡æ‰«ç ç™»å½•
3. è·å–ç”¨æˆ·openid
4. ç”Ÿæˆç”¨æˆ·è´¦æˆ·
5. æ˜¾ç¤ºè®¢é˜…çŠ¶æ€
```

### 2. è´­ä¹°æµç¨‹
```
1. é€‰æ‹©ä¸“ä¸šç‰ˆå¥—é¤
2. å¾®ä¿¡æ‰«ç æ”¯ä»˜
3. æ”¯ä»˜æˆåŠŸå›è°ƒ
4. æ¿€æ´»ç”¨æˆ·æˆæƒ
5. ç”Ÿæˆæˆæƒç 
6. æ’ä»¶éªŒè¯æˆæƒ
```

### 3. æ’ä»¶æˆæƒéªŒè¯
```javascript
// æ’ä»¶ç«¯æˆæƒæ£€æŸ¥
async function checkLicense() {
  const userToken = await chrome.storage.local.get(['userToken']);
  
  if (!userToken) {
    // æœªç™»å½•ï¼Œä½¿ç”¨å…è´¹ç‰ˆé™åˆ¶
    return { type: 'free', limit: 20 };
  }
  
  // å‘æœåŠ¡å™¨éªŒè¯æˆæƒ
  const response = await fetch('https://api.zhiliuhuaxie.com/auth/verify', {
    method: 'POST',
    headers: { 'Authorization': `Bearer ${userToken}` }
  });
  
  const result = await response.json();
  return result; // { type: 'premium', limit: -1 } æˆ– { type: 'free', limit: 20 }
}
```

---

## ğŸ”— ç½‘ç«™ä¸æ’ä»¶äº’åŠ¨æœºåˆ¶

### 1. ç”¨æˆ·æˆæƒåŒæ­¥æµç¨‹
```
ç½‘ç«™ç™»å½• â†’ æ’ä»¶æˆæƒåŒæ­¥æµç¨‹ï¼š

1. ç”¨æˆ·åœ¨ç½‘ç«™ç™»å½•/è´­ä¹°
2. ç½‘ç«™ç”Ÿæˆç”¨æˆ·Tokenå’Œæˆæƒä¿¡æ¯
3. ç”¨æˆ·åœ¨æ’ä»¶ä¸­è¾“å…¥æˆæƒç æˆ–æ‰«ç ç»‘å®š
4. æ’ä»¶è·å–å¹¶å­˜å‚¨ç”¨æˆ·æˆæƒä¿¡æ¯
5. æ’ä»¶å®æ—¶éªŒè¯ç”¨æˆ·æƒé™çŠ¶æ€
```

### 2. æ’ä»¶æˆæƒç»‘å®šæ–¹å¼

#### æ–¹å¼ä¸€ï¼šæˆæƒç ç»‘å®š
```javascript
// ç½‘ç«™ç”Ÿæˆæˆæƒç 
function generateAuthCode(userId) {
  const authCode = generateRandomCode(8); // 8ä½éšæœºç 
  const expireTime = Date.now() + 10 * 60 * 1000; // 10åˆ†é’Ÿæœ‰æ•ˆ
  
  // å­˜å‚¨åˆ°Redis
  redis.setex(`auth_code:${authCode}`, 600, JSON.stringify({
    userId,
    expireTime,
    used: false
  }));
  
  return authCode;
}

// æ’ä»¶ç«¯è¾“å…¥æˆæƒç 
async function bindWithAuthCode(authCode) {
  const response = await fetch('https://api.zhiliuhuaxie.com/auth/bind', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ authCode })
  });
  
  if (response.ok) {
    const { token, userInfo, subscription } = await response.json();
    
    // å­˜å‚¨åˆ°æ’ä»¶æœ¬åœ°
    await chrome.storage.local.set({
      userToken: token,
      userInfo: userInfo,
      subscription: subscription,
      lastSync: Date.now()
    });
    
    return { success: true };
  }
}
```

#### æ–¹å¼äºŒï¼šäºŒç»´ç æ‰«ç ç»‘å®š
```javascript
// ç½‘ç«™ç”Ÿæˆç»‘å®šäºŒç»´ç 
function generateBindingQR(userId) {
  const bindingId = generateUUID();
  const qrData = {
    type: 'plugin_binding',
    bindingId,
    userId,
    timestamp: Date.now()
  };
  
  // å­˜å‚¨ç»‘å®šä¿¡æ¯
  redis.setex(`binding:${bindingId}`, 300, JSON.stringify({
    userId,
    status: 'pending',
    createdAt: Date.now()
  }));
  
  return `https://zhiliuhuaxie.com/bind/${bindingId}`;
}

// æ’ä»¶æ‰«ç ç»‘å®š
async function bindWithQR(bindingId) {
  const response = await fetch(`https://api.zhiliuhuaxie.com/auth/bind/${bindingId}`, {
    method: 'POST'
  });
  
  if (response.ok) {
    const { token, userInfo, subscription } = await response.json();
    // å­˜å‚¨æˆæƒä¿¡æ¯...
  }
}
```

### 3. å®æ—¶æƒé™éªŒè¯ç³»ç»Ÿ
```javascript
// æ’ä»¶ç«¯æƒé™æ£€æŸ¥ï¼ˆæ¯æ¬¡æ“ä½œå‰è°ƒç”¨ï¼‰
class PermissionManager {
  constructor() {
    this.lastCheck = 0;
    this.checkInterval = 5 * 60 * 1000; // 5åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
    this.userPermission = null;
  }

  async checkPermission(forceCheck = false) {
    const now = Date.now();
    
    // å¦‚æœè·ç¦»ä¸Šæ¬¡æ£€æŸ¥ä¸åˆ°5åˆ†é’Ÿä¸”ä¸æ˜¯å¼ºåˆ¶æ£€æŸ¥ï¼Œä½¿ç”¨ç¼“å­˜
    if (!forceCheck && (now - this.lastCheck) < this.checkInterval && this.userPermission) {
      return this.userPermission;
    }

    try {
      const { userToken } = await chrome.storage.local.get(['userToken']);
      
      if (!userToken) {
        this.userPermission = { type: 'free', limit: 20, used: 0 };
        return this.userPermission;
      }

      const response = await fetch('https://api.zhiliuhuaxie.com/auth/permission', {
        method: 'GET',
        headers: {
          'Authorization': `Bearer ${userToken}`,
          'Content-Type': 'application/json'
        }
      });

      if (response.ok) {
        const permission = await response.json();
        this.userPermission = permission;
        this.lastCheck = now;
        
        // æ›´æ–°æœ¬åœ°å­˜å‚¨
        await chrome.storage.local.set({
          lastPermissionCheck: now,
          userPermission: permission
        });
        
        return permission;
      } else if (response.status === 401) {
        // Tokenè¿‡æœŸï¼Œæ¸…é™¤æœ¬åœ°æ•°æ®
        await this.clearUserData();
        this.userPermission = { type: 'free', limit: 20, used: 0 };
        return this.userPermission;
      }
    } catch (error) {
      console.error('æƒé™æ£€æŸ¥å¤±è´¥:', error);
      // ç½‘ç»œé”™è¯¯æ—¶ä½¿ç”¨æœ¬åœ°ç¼“å­˜
      const { userPermission } = await chrome.storage.local.get(['userPermission']);
      return userPermission || { type: 'free', limit: 20, used: 0 };
    }
  }

  async clearUserData() {
    await chrome.storage.local.remove([
      'userToken', 'userInfo', 'subscription', 
      'userPermission', 'lastPermissionCheck'
    ]);
  }
}
```

### 4. ä½¿ç”¨ç»Ÿè®¡åŒæ­¥
```javascript
// æ’ä»¶ä½¿ç”¨ç»Ÿè®¡ä¸ŠæŠ¥
class UsageReporter {
  constructor() {
    this.pendingReports = [];
    this.reportInterval = 30 * 1000; // 30ç§’ä¸ŠæŠ¥ä¸€æ¬¡
    this.startReporting();
  }

  // è®°å½•æˆªå›¾æ“ä½œ
  async recordScreenshot(screenshotData) {
    const usage = {
      type: 'screenshot',
      timestamp: Date.now(),
      url: screenshotData.url,
      title: screenshotData.title
    };
    
    this.pendingReports.push(usage);
    
    // ç«‹å³æ£€æŸ¥æ˜¯å¦éœ€è¦é™åˆ¶
    const permission = await permissionManager.checkPermission();
    if (permission.type === 'free') {
      const currentUsage = await this.getCurrentUsage();
      if (currentUsage.screenshots >= permission.limit) {
        throw new Error('å·²è¾¾åˆ°å…è´¹ç‰ˆä½¿ç”¨é™åˆ¶');
      }
    }
  }

  // è®°å½•å¯¼å‡ºæ“ä½œ
  async recordExport(exportData) {
    const usage = {
      type: 'export',
      format: exportData.format,
      timestamp: Date.now(),
      pageCount: exportData.pageCount
    };
    
    this.pendingReports.push(usage);
  }

  // å®šæ—¶ä¸ŠæŠ¥ä½¿ç”¨ç»Ÿè®¡
  async startReporting() {
    setInterval(async () => {
      if (this.pendingReports.length > 0) {
        await this.submitUsageReports();
      }
    }, this.reportInterval);
  }

  async submitUsageReports() {
    const { userToken } = await chrome.storage.local.get(['userToken']);
    
    if (!userToken || this.pendingReports.length === 0) return;

    try {
      const response = await fetch('https://api.zhiliuhuaxie.com/usage/report', {
        method: 'POST',
        headers: {
          'Authorization': `Bearer ${userToken}`,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          reports: this.pendingReports
        })
      });

      if (response.ok) {
        this.pendingReports = []; // æ¸…ç©ºå·²ä¸ŠæŠ¥çš„æ•°æ®
      }
    } catch (error) {
      console.error('ä½¿ç”¨ç»Ÿè®¡ä¸ŠæŠ¥å¤±è´¥:', error);
      // å¤±è´¥æ—¶ä¿ç•™æ•°æ®ï¼Œä¸‹æ¬¡ç»§ç»­å°è¯•
    }
  }

  async getCurrentUsage() {
    const { userToken } = await chrome.storage.local.get(['userToken']);
    
    if (!userToken) {
      // æœªç™»å½•ç”¨æˆ·ï¼Œä»æœ¬åœ°å­˜å‚¨è·å–
      const { screenshotCount = 0 } = await chrome.storage.local.get(['screenshotCount']);
      return { screenshots: screenshotCount, exports: 0 };
    }

    try {
      const response = await fetch('https://api.zhiliuhuaxie.com/usage/current', {
        method: 'GET',
        headers: {
          'Authorization': `Bearer ${userToken}`
        }
      });

      if (response.ok) {
        return await response.json();
      }
    } catch (error) {
      console.error('è·å–ä½¿ç”¨ç»Ÿè®¡å¤±è´¥:', error);
    }

    return { screenshots: 0, exports: 0 };
  }
}
```

### 5. ç½‘ç«™ç”¨æˆ·ä¸­å¿ƒåŠŸèƒ½
```html
<!-- ç”¨æˆ·ä¸­å¿ƒ - æ’ä»¶ç®¡ç†é¡µé¢ -->
<div class="plugin-management">
  <h3>æ’ä»¶ç®¡ç†</h3>
  
  <!-- æ’ä»¶ç»‘å®šçŠ¶æ€ -->
  <div class="binding-status">
    <div v-if="!pluginBound" class="not-bound">
      <p>æ’ä»¶æœªç»‘å®š</p>
      <div class="binding-methods">
        <div class="method-tabs">
          <button @click="activeTab = 'code'" :class="{active: activeTab === 'code'}">
            æˆæƒç ç»‘å®š
          </button>
          <button @click="activeTab = 'qr'" :class="{active: activeTab === 'qr'}">
            æ‰«ç ç»‘å®š
          </button>
        </div>
        
        <!-- æˆæƒç ç»‘å®š -->
        <div v-if="activeTab === 'code'" class="auth-code-method">
          <div class="auth-code-display">
            <span class="code">{{ authCode }}</span>
            <button @click="refreshAuthCode">åˆ·æ–°</button>
          </div>
          <p class="instructions">
            1. æ‰“å¼€æ™ºæµåå†™æ’ä»¶<br>
            2. ç‚¹å‡»"ç»‘å®šè´¦æˆ·"<br>
            3. è¾“å…¥ä¸Šæ–¹æˆæƒç 
          </p>
        </div>
        
        <!-- äºŒç»´ç ç»‘å®š -->
        <div v-if="activeTab === 'qr'" class="qr-method">
          <div class="qr-code">
            <img :src="qrCodeUrl" alt="ç»‘å®šäºŒç»´ç ">
          </div>
          <p class="instructions">
            ä½¿ç”¨æ™ºæµåå†™æ’ä»¶æ‰«æäºŒç»´ç å®Œæˆç»‘å®š
          </p>
        </div>
      </div>
    </div>
    
    <!-- å·²ç»‘å®šçŠ¶æ€ -->
    <div v-else class="bound">
      <div class="bound-info">
        <span class="status-icon">âœ…</span>
        <span>æ’ä»¶å·²ç»‘å®š</span>
        <span class="bind-time">ç»‘å®šæ—¶é—´: {{ bindTime }}</span>
      </div>
      <button @click="unbindPlugin" class="unbind-btn">è§£é™¤ç»‘å®š</button>
    </div>
  </div>
  
  <!-- ä½¿ç”¨ç»Ÿè®¡ -->
  <div class="usage-stats">
    <h4>æœ¬æœˆä½¿ç”¨ç»Ÿè®¡</h4>
    <div class="stats-grid">
      <div class="stat-item">
        <span class="label">æˆªå›¾æ¬¡æ•°</span>
        <span class="value">{{ usage.screenshots }}</span>
      </div>
      <div class="stat-item">
        <span class="label">å¯¼å‡ºæ¬¡æ•°</span>
        <span class="value">{{ usage.exports }}</span>
      </div>
      <div class="stat-item">
        <span class="label">ä½¿ç”¨å¤©æ•°</span>
        <span class="value">{{ usage.activeDays }}</span>
      </div>
    </div>
  </div>
  
  <!-- è®¢é˜…çŠ¶æ€ -->
  <div class="subscription-status">
    <h4>è®¢é˜…çŠ¶æ€</h4>
    <div v-if="subscription.type === 'premium'" class="premium-status">
      <span class="status">ä¸“ä¸šç‰ˆ</span>
      <span class="expire-date">åˆ°æœŸæ—¶é—´: {{ subscription.endDate }}</span>
      <button v-if="subscription.daysLeft <= 30" @click="renewSubscription" class="renew-btn">
        ç»­è´¹ ({{ subscription.daysLeft }}å¤©ååˆ°æœŸ)
      </button>
    </div>
    <div v-else class="free-status">
      <span class="status">å…è´¹ç‰ˆ</span>
      <span class="limit">å‰©ä½™ {{ 20 - usage.screenshots }} æ¬¡æˆªå›¾</span>
      <button @click="upgradeSubscription" class="upgrade-btn">
        å‡çº§ä¸“ä¸šç‰ˆ
      </button>
    </div>
  </div>
</div>
```

### 6. APIæ¥å£è®¾è®¡
```javascript
// åç«¯APIæ¥å£
const apiRoutes = {
  // æƒé™éªŒè¯
  'GET /auth/permission': async (req, res) => {
    const userId = req.user.id;
    const subscription = await getActiveSubscription(userId);
    const usage = await getCurrentMonthUsage(userId);
    
    if (subscription && subscription.status === 'active' && subscription.endDate > new Date()) {
      res.json({
        type: 'premium',
        limit: -1,
        used: usage.screenshots,
        subscription: subscription,
        features: ['unlimited_screenshots', 'md_export', 'priority_support']
      });
    } else {
      res.json({
        type: 'free',
        limit: 20,
        used: usage.screenshots,
        features: ['basic_screenshots', 'pdf_export']
      });
    }
  },

  // ä½¿ç”¨ç»Ÿè®¡ä¸ŠæŠ¥
  'POST /usage/report': async (req, res) => {
    const userId = req.user.id;
    const { reports } = req.body;
    
    for (const report of reports) {
      await saveUsageRecord({
        userId,
        type: report.type,
        timestamp: new Date(report.timestamp),
        metadata: report
      });
    }
    
    res.json({ success: true });
  },

  // æ’ä»¶ç»‘å®š
  'POST /auth/bind': async (req, res) => {
    const { authCode } = req.body;
    const bindingInfo = await redis.get(`auth_code:${authCode}`);
    
    if (!bindingInfo) {
      return res.status(400).json({ error: 'æˆæƒç æ— æ•ˆæˆ–å·²è¿‡æœŸ' });
    }
    
    const { userId } = JSON.parse(bindingInfo);
    const user = await getUserById(userId);
    const subscription = await getActiveSubscription(userId);
    
    // ç”Ÿæˆæ’ä»¶ä¸“ç”¨Token
    const pluginToken = jwt.sign(
      { userId, type: 'plugin' },
      process.env.JWT_SECRET,
      { expiresIn: '365d' }
    );
    
    // æ ‡è®°æˆæƒç å·²ä½¿ç”¨
    await redis.del(`auth_code:${authCode}`);
    
    // è®°å½•ç»‘å®šä¿¡æ¯
    await savePluginBinding({
      userId,
      token: pluginToken,
      bindTime: new Date(),
      userAgent: req.headers['user-agent']
    });
    
    res.json({
      token: pluginToken,
      userInfo: {
        id: user.id,
        nickname: user.nickname,
        avatar: user.avatar
      },
      subscription: subscription
    });
  }
};
```

---

## ğŸ’» æŠ€æœ¯æ¶æ„

### å‰ç«¯æŠ€æœ¯æ ˆ
```
- æ¡†æ¶ï¼šNext.js 14 (React)
- æ ·å¼ï¼šTailwind CSS
- UIç»„ä»¶ï¼šShadcn/ui
- çŠ¶æ€ç®¡ç†ï¼šZustand
- æ”¯ä»˜é›†æˆï¼šå¾®ä¿¡æ”¯ä»˜SDK
```

### åç«¯æŠ€æœ¯æ ˆ
```
- æ¡†æ¶ï¼šNode.js + Express
- æ•°æ®åº“ï¼šMongoDB
- è®¤è¯ï¼šJWT + å¾®ä¿¡OAuth
- æ”¯ä»˜ï¼šå¾®ä¿¡æ”¯ä»˜API
- éƒ¨ç½²ï¼šVercel/é˜¿é‡Œäº‘
```

### æ•°æ®åº“è®¾è®¡
```javascript
// ç”¨æˆ·è¡¨
const UserSchema = {
  _id: ObjectId,
  openid: String,        // å¾®ä¿¡openid
  nickname: String,      // å¾®ä¿¡æ˜µç§°
  avatar: String,        // å¤´åƒURL
  phone: String,         // æ‰‹æœºå·
  email: String,         // é‚®ç®±
  createdAt: Date,
  updatedAt: Date
}

// è®¢é˜…è¡¨
const SubscriptionSchema = {
  _id: ObjectId,
  userId: ObjectId,      // ç”¨æˆ·ID
  type: String,          // 'free' | 'premium'
  startDate: Date,       // å¼€å§‹æ—¶é—´
  endDate: Date,         // ç»“æŸæ—¶é—´
  status: String,        // 'active' | 'expired' | 'cancelled'
  paymentId: String,     // æ”¯ä»˜è®¢å•å·
  createdAt: Date
}

// ä½¿ç”¨ç»Ÿè®¡è¡¨
const UsageSchema = {
  _id: ObjectId,
  userId: ObjectId,
  date: Date,           // ä½¿ç”¨æ—¥æœŸ
  screenshotCount: Number, // å½“æ—¥æˆªå›¾æ•°é‡
  documentCount: Number,   // å½“æ—¥æ–‡æ¡£ç”Ÿæˆæ•°é‡
}
```

---

## ğŸ¨ UI/UX è®¾è®¡

### 1. è®¾è®¡é£æ ¼
```
- è‰²å½©æ–¹æ¡ˆï¼šè“ç»¿è‰²ä¸»è‰²è°ƒ (#00CED1, #20B2AA)
- è®¾è®¡é£æ ¼ï¼šç°ä»£ç®€çº¦ï¼Œä¸“ä¸šå•†åŠ¡
- å­—ä½“ï¼šæ€æºé»‘ä½“/Inter
- å¸ƒå±€ï¼šå“åº”å¼è®¾è®¡ï¼Œç§»åŠ¨ç«¯å‹å¥½
```

### 2. å…³é”®é¡µé¢è®¾è®¡

#### é¦–é¡µè®¾è®¡
```html
<!-- Hero Section -->
<section class="bg-gradient-to-r from-cyan-500 to-teal-500">
  <div class="container mx-auto px-4 py-20">
    <div class="text-center text-white">
      <h1 class="text-5xl font-bold mb-6">æ™ºæµåå†™</h1>
      <p class="text-xl mb-8">è®©æ“ä½œè®°å½•å˜å¾—ç®€å•ï¼Œè®©æ–‡æ¡£ç¼–å†™æ›´é«˜æ•ˆ</p>
      <div class="space-x-4">
        <button id="wechat-login-btn" class="bg-white text-teal-600 px-8 py-3 rounded-lg font-semibold flex items-center gap-2 hover:bg-gray-100 transition-colors">
          <svg class="w-5 h-5" viewBox="0 0 24 24" fill="#07C160">
            <path d="M18.5 9.5c0-4.1-4-7.5-8.5-7.5S1.5 5.4 1.5 9.5c0 2.4 1.3 4.5 3.3 5.8-.2.6-.5 1.8-.5 1.8s1.3-.4 2.3-.8c.7.2 1.4.3 2.2.3 4.5 0 8.2-3.4 8.2-7.6zm-11.8.9c-.6 0-1.1-.5-1.1-1.1s.5-1.1 1.1-1.1 1.1.5 1.1 1.1-.5 1.1-1.1 1.1zm5.6 0c-.6 0-1.1-.5-1.1-1.1s.5-1.1 1.1-1.1 1.1.5 1.1 1.1-.5 1.1-1.1 1.1z"/>
            <path d="M22.5 14.5c0-3.2-3.2-5.8-6.8-5.8s-6.8 2.6-6.8 5.8c0 1.9 1 3.6 2.6 4.6-.2.5-.4 1.4-.4 1.4s1-.3 1.8-.6c.5.1 1.1.2 1.7.2 3.6 0 6.8-2.6 6.8-5.6z"/>
          </svg>
          å¾®ä¿¡ç™»å½•
        </button>
        <button class="border-2 border-white text-white px-8 py-3 rounded-lg font-semibold hover:bg-white hover:text-teal-600 transition-colors">
          äº†è§£æ›´å¤š
        </button>
      </div>
    </div>
  </div>
</section>

<!-- åŠŸèƒ½ç‰¹è‰² -->
<section class="py-20">
  <div class="container mx-auto px-4">
    <h2 class="text-3xl font-bold text-center mb-12">æ ¸å¿ƒåŠŸèƒ½</h2>
    <div class="grid md:grid-cols-3 gap-8">
      <!-- åŠŸèƒ½å¡ç‰‡ -->
    </div>
  </div>
</section>
```

#### å®šä»·é¡µé¢è®¾è®¡
```html
<section class="py-20 bg-gray-50">
  <div class="container mx-auto px-4">
    <h2 class="text-3xl font-bold text-center mb-12">é€‰æ‹©é€‚åˆæ‚¨çš„æ–¹æ¡ˆ</h2>
    <div class="grid md:grid-cols-2 gap-8 max-w-4xl mx-auto">
      
      <!-- å…è´¹ç‰ˆ -->
      <div class="bg-white rounded-lg shadow-lg p-8">
        <h3 class="text-2xl font-bold mb-4">å…è´¹ç‰ˆ</h3>
        <div class="text-3xl font-bold mb-6">Â¥0 <span class="text-lg text-gray-500">/æ°¸ä¹…</span></div>
        <ul class="space-y-3 mb-8">
          <li class="flex items-center">
            <svg class="w-5 h-5 text-green-500 mr-3">âœ“</svg>
            åŸºç¡€å½•åˆ¶åŠŸèƒ½
          </li>
          <li class="flex items-center">
            <svg class="w-5 h-5 text-green-500 mr-3">âœ“</svg>
            20é¡µæˆªå›¾é™åˆ¶
          </li>
        </ul>
        <button class="w-full bg-gray-200 text-gray-800 py-3 rounded-lg">
          å½“å‰æ–¹æ¡ˆ
        </button>
      </div>
      
      <!-- ä¸“ä¸šç‰ˆ -->
      <div class="bg-white rounded-lg shadow-lg p-8 border-2 border-teal-500 relative">
        <div class="absolute -top-4 left-1/2 transform -translate-x-1/2">
          <span class="bg-teal-500 text-white px-4 py-1 rounded-full text-sm">æ¨è</span>
        </div>
        <h3 class="text-2xl font-bold mb-4">ä¸“ä¸šç‰ˆ</h3>
        <div class="text-3xl font-bold mb-6">Â¥49 <span class="text-lg text-gray-500">/å¹´</span></div>
        <ul class="space-y-3 mb-8">
          <li class="flex items-center">
            <svg class="w-5 h-5 text-green-500 mr-3">âœ“</svg>
            æ— é™åˆ¶å½•åˆ¶
          </li>
          <li class="flex items-center">
            <svg class="w-5 h-5 text-green-500 mr-3">âœ“</svg>
            æ— é™æˆªå›¾æ•°é‡
          </li>
          <li class="flex items-center">
            <svg class="w-5 h-5 text-green-500 mr-3">âœ“</svg>
            ä¼˜å…ˆæŠ€æœ¯æ”¯æŒ
          </li>
        </ul>
        <button class="w-full bg-teal-500 text-white py-3 rounded-lg hover:bg-teal-600">
          ç«‹å³è´­ä¹°
        </button>
      </div>
    </div>
  </div>
</section>
```

---

## ğŸ“± å¾®ä¿¡ç™»å½•é›†æˆ

### 1. ç®€åŒ–çš„å¾®ä¿¡ç™»å½•å®ç°
```javascript
// å¾®ä¿¡ç™»å½•é…ç½®
const wechatConfig = {
  appId: 'your_wechat_appid',
  appSecret: 'your_wechat_secret',
  redirectUri: 'https://zhiliuhuaxie.com/auth/callback',
  scope: 'snsapi_login'
}

// å‰ç«¯ï¼šä¸€é”®å¾®ä¿¡ç™»å½•
function initWechatLogin() {
  const loginBtn = document.getElementById('wechat-login-btn');
  
  loginBtn.onclick = () => {
    // æ˜¾ç¤ºç™»å½•äºŒç»´ç å¼¹çª—
    showWechatQRModal();
  };
}

function showWechatQRModal() {
  const state = generateRandomString(32);
  const qrUrl = `https://open.weixin.qq.com/connect/qrconnect?` +
    `appid=${wechatConfig.appId}&` +
    `redirect_uri=${encodeURIComponent(wechatConfig.redirectUri)}&` +
    `response_type=code&` +
    `scope=${wechatConfig.scope}&` +
    `state=${state}`;

  // åˆ›å»ºç™»å½•å¼¹çª—
  const modal = document.createElement('div');
  modal.innerHTML = `
    <div class="login-modal-overlay">
      <div class="login-modal">
        <div class="modal-header">
          <h3>å¾®ä¿¡ç™»å½•</h3>
          <button class="close-btn">&times;</button>
        </div>
        <div class="modal-body">
          <div class="qr-container">
            <iframe src="${qrUrl}" width="300" height="400" frameborder="0"></iframe>
          </div>
          <p class="login-tip">è¯·ä½¿ç”¨å¾®ä¿¡æ‰«æäºŒç»´ç ç™»å½•</p>
        </div>
      </div>
    </div>
  `;
  
  document.body.appendChild(modal);
  
  // ç»‘å®šå…³é—­äº‹ä»¶
  modal.querySelector('.close-btn').onclick = () => {
    document.body.removeChild(modal);
  };
  
  // ç›‘å¬ç™»å½•æˆåŠŸ
  window.addEventListener('message', (event) => {
    if (event.data.type === 'wechat_login_success') {
      document.body.removeChild(modal);
      window.location.reload(); // åˆ·æ–°é¡µé¢æ˜¾ç¤ºç™»å½•çŠ¶æ€
    }
  });
}

// åç«¯ï¼šå¤„ç†å¾®ä¿¡ç™»å½•å›è°ƒ
app.get('/auth/callback', async (req, res) => {
  const { code, state } = req.query;
  
  try {
    // 1. é€šè¿‡codeè·å–access_token
    const tokenResponse = await axios.get('https://api.weixin.qq.com/sns/oauth2/access_token', {
      params: {
        appid: wechatConfig.appId,
        secret: wechatConfig.appSecret,
        code: code,
        grant_type: 'authorization_code'
      }
    });
    
    const { access_token, openid } = tokenResponse.data;
    
    // 2. è·å–ç”¨æˆ·ä¿¡æ¯
    const userResponse = await axios.get('https://api.weixin.qq.com/sns/userinfo', {
      params: {
        access_token: access_token,
        openid: openid
      }
    });
    
    const wechatUser = userResponse.data;
    
    // 3. æŸ¥æ‰¾æˆ–åˆ›å»ºç”¨æˆ·
    let user = await User.findOne({ openid: openid });
    
    if (!user) {
      // æ–°ç”¨æˆ·ï¼Œè‡ªåŠ¨æ³¨å†Œ
      user = await User.create({
        openid: openid,
        nickname: wechatUser.nickname,
        avatar: wechatUser.headimgurl,
        createdAt: new Date()
      });
      
      // åˆ›å»ºå…è´¹è®¢é˜…
      await Subscription.create({
        userId: user._id,
        type: 'free',
        status: 'active',
        startDate: new Date(),
        endDate: new Date('2099-12-31') // å…è´¹ç‰ˆæ°¸ä¸è¿‡æœŸ
      });
    } else {
      // è€ç”¨æˆ·ï¼Œæ›´æ–°ä¿¡æ¯
      await User.updateOne(
        { _id: user._id },
        {
          nickname: wechatUser.nickname,
          avatar: wechatUser.headimgurl,
          lastLoginAt: new Date()
        }
      );
    }
    
    // 4. ç”ŸæˆJWT Token
    const token = jwt.sign(
      { userId: user._id, openid: user.openid },
      process.env.JWT_SECRET,
      { expiresIn: '30d' }
    );
    
    // 5. è®¾ç½®Cookieå¹¶è·³è½¬
    res.cookie('auth_token', token, {
      httpOnly: true,
      secure: true,
      maxAge: 30 * 24 * 60 * 60 * 1000 // 30å¤©
    });
    
    // è·³è½¬åˆ°ç”¨æˆ·ä¸­å¿ƒ
    res.redirect('/dashboard');
    
  } catch (error) {
    console.error('å¾®ä¿¡ç™»å½•å¤±è´¥:', error);
    res.redirect('/?error=login_failed');
  }
});
```

### 2. æ”¯ä»˜é›†æˆ
```javascript
// å¾®ä¿¡æ”¯ä»˜é…ç½®
const wxPayConfig = {
  mchId: 'your_mch_id',
  key: 'your_api_key',
  notifyUrl: 'https://zhiliuhuaxie.com/api/payment/notify'
}

// åˆ›å»ºæ”¯ä»˜è®¢å•
async function createPaymentOrder(userId, amount) {
  const order = {
    out_trade_no: generateOrderNo(),
    body: 'æ™ºæµåå†™ä¸“ä¸šç‰ˆ-å¹´è´¹è®¢é˜…',
    total_fee: amount * 100, // åˆ†ä¸ºå•ä½
    spbill_create_ip: getClientIP(),
    notify_url: wxPayConfig.notifyUrl,
    trade_type: 'NATIVE'
  };
  
  // è°ƒç”¨å¾®ä¿¡æ”¯ä»˜API
  const result = await wxpay.unifiedOrder(order);
  return result.code_url; // è¿”å›æ”¯ä»˜äºŒç»´ç 
}
```

---

## ğŸ”§ æ’ä»¶æˆæƒæ”¹é€ 

### 1. æ·»åŠ æˆæƒæ£€æŸ¥
```javascript
// content.js ä¸­æ·»åŠ æˆæƒæ£€æŸ¥
class ContentRecorder {
  constructor() {
    this.screenshotCount = 0;
    this.userLicense = null;
    this.init();
  }

  async init() {
    // æ£€æŸ¥ç”¨æˆ·æˆæƒ
    this.userLicense = await this.checkLicense();
    console.log('ç”¨æˆ·æˆæƒçŠ¶æ€:', this.userLicense);
  }

  async checkLicense() {
    try {
      const result = await chrome.storage.local.get(['userToken', 'screenshotCount']);
      
      if (!result.userToken) {
        return { type: 'free', limit: 20, used: result.screenshotCount || 0 };
      }

      // å‘æœåŠ¡å™¨éªŒè¯æˆæƒ
      const response = await fetch('https://api.zhiliuhuaxie.com/auth/verify', {
        method: 'POST',
        headers: {
          'Authorization': `Bearer ${result.userToken}`,
          'Content-Type': 'application/json'
        }
      });

      if (response.ok) {
        const data = await response.json();
        return data;
      } else {
        return { type: 'free', limit: 20, used: result.screenshotCount || 0 };
      }
    } catch (error) {
      console.error('æˆæƒéªŒè¯å¤±è´¥:', error);
      return { type: 'free', limit: 20, used: 0 };
    }
  }

  async captureScreenshot() {
    // æ£€æŸ¥æ˜¯å¦è¶…å‡ºé™åˆ¶
    if (this.userLicense.type === 'free' && this.screenshotCount >= this.userLicense.limit) {
      this.showUpgradeDialog();
      return;
    }

    // æ‰§è¡Œæˆªå›¾
    this.screenshotCount++;
    await chrome.storage.local.set({ screenshotCount: this.screenshotCount });
    
    // åŸæœ‰æˆªå›¾é€»è¾‘...
  }

  async exportDocument(format = 'auto') {
    // æ ¹æ®ç”¨æˆ·æˆæƒå†³å®šå¯¼å‡ºæ ¼å¼
    const allowedFormat = this.userLicense.type === 'premium' ? format : 'pdf';
    
    if (format === 'md' && this.userLicense.type === 'free') {
      this.showFormatUpgradeDialog();
      return;
    }
    
    // æ‰§è¡Œç›¸åº”æ ¼å¼çš„å¯¼å‡º
    if (allowedFormat === 'pdf') {
      await this.exportToPDF();
    } else {
      await this.exportToMarkdown();
    }
  }

  showUpgradeDialog() {
    const dialog = document.createElement('div');
    dialog.innerHTML = `
      <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                  background: rgba(0,0,0,0.5); z-index: 999999; display: flex; 
                  align-items: center; justify-content: center;">
        <div style="background: white; padding: 30px; border-radius: 10px; 
                    text-align: center; max-width: 400px;">
          <h3 style="margin-bottom: 15px; color: #333;">å…è´¹ç‰ˆé™åˆ¶</h3>
          <p style="margin-bottom: 20px; color: #666;">
            æ‚¨å·²è¾¾åˆ°å…è´¹ç‰ˆ20é¡µæˆªå›¾é™åˆ¶<br>
            å‡çº§åˆ°ä¸“ä¸šç‰ˆäº«å—æ— é™åˆ¶ä½¿ç”¨
          </p>
          <div style="display: flex; gap: 10px; justify-content: center;">
            <button id="upgradeBtn" style="background: #20B2AA; color: white; 
                    border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">
              ç«‹å³å‡çº§ Â¥49/å¹´
            </button>
            <button id="cancelBtn" style="background: #ccc; color: #333; 
                    border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">
              å–æ¶ˆ
            </button>
          </div>
        </div>
      </div>
    `;
    
    document.body.appendChild(dialog);
    
    document.getElementById('upgradeBtn').onclick = () => {
      window.open('https://zhiliuhuaxie.com/pricing', '_blank');
      dialog.remove();
    };
    
    document.getElementById('cancelBtn').onclick = () => {
      dialog.remove();
    };
  }

  showFormatUpgradeDialog() {
    const dialog = document.createElement('div');
    dialog.innerHTML = `
      <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                  background: rgba(0,0,0,0.5); z-index: 999999; display: flex; 
                  align-items: center; justify-content: center;">
        <div style="background: white; padding: 30px; border-radius: 10px; 
                    text-align: center; max-width: 400px;">
          <h3 style="margin-bottom: 15px; color: #333;">æ ¼å¼é™åˆ¶</h3>
          <p style="margin-bottom: 20px; color: #666;">
            å…è´¹ç‰ˆä»…æ”¯æŒPDFæ ¼å¼å¯¼å‡º<br>
            å‡çº§åˆ°ä¸“ä¸šç‰ˆæ”¯æŒMDæ ¼å¼å¯¼å‡º
          </p>
          <div style="display: flex; gap: 10px; justify-content: center;">
            <button id="exportPdfBtn" style="background: #666; color: white; 
                    border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">
              å¯¼å‡ºPDF
            </button>
            <button id="upgradeBtn" style="background: #20B2AA; color: white; 
                    border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">
              å‡çº§ä¸“ä¸šç‰ˆ
            </button>
          </div>
        </div>
      </div>
    `;
    
    document.body.appendChild(dialog);
    
    document.getElementById('exportPdfBtn').onclick = () => {
      this.exportToPDF();
      dialog.remove();
    };
    
    document.getElementById('upgradeBtn').onclick = () => {
      window.open('https://zhiliuhuaxie.com/pricing', '_blank');
      dialog.remove();
    };
  }
}
```

### 2. æ·»åŠ ç™»å½•åŠŸèƒ½
```javascript
// popup.js ä¸­æ·»åŠ ç™»å½•åŠŸèƒ½
class PopupController {
  constructor() {
    this.userInfo = null;
    this.init();
  }

  async init() {
    await this.loadUserInfo();
    this.bindEvents();
    this.updateUI();
  }

  async loadUserInfo() {
    const result = await chrome.storage.local.get(['userToken', 'userInfo']);
    if (result.userToken && result.userInfo) {
      this.userInfo = result.userInfo;
    }
  }

  showLoginDialog() {
    // æ‰“å¼€ç™»å½•é¡µé¢
    chrome.tabs.create({ url: 'https://zhiliuhuaxie.com/login' });
  }

  updateUI() {
    const userSection = document.getElementById('userSection');
    if (this.userInfo) {
      userSection.innerHTML = `
        <div class="user-info">
          <img src="${this.userInfo.avatar}" class="avatar">
          <span>${this.userInfo.nickname}</span>
          <span class="license-type">${this.userInfo.licenseType === 'premium' ? 'ä¸“ä¸šç‰ˆ' : 'å…è´¹ç‰ˆ'}</span>
        </div>
      `;
    } else {
      userSection.innerHTML = `
        <button id="loginBtn" class="btn btn-info">ç™»å½•è´¦æˆ·</button>
      `;
      document.getElementById('loginBtn').onclick = () => this.showLoginDialog();
    }
  }
}
```

---

## ğŸ”„ ç»­è´¹æœºåˆ¶è®¾è®¡

### 1. ç»­è´¹æé†’ç­–ç•¥
```
åˆ°æœŸå‰æé†’æ—¶é—´çº¿ï¼š
- 30å¤©å‰ï¼šé¦–æ¬¡ç»­è´¹æé†’ï¼ˆé‚®ä»¶+æ’ä»¶å†…é€šçŸ¥ï¼‰
- 15å¤©å‰ï¼šç¬¬äºŒæ¬¡æé†’ï¼ˆæ’ä»¶å¼¹çª—ï¼‰
- 7å¤©å‰ï¼šç´§æ€¥æé†’ï¼ˆæ¯æ—¥æé†’ï¼‰
- 3å¤©å‰ï¼šæœ€åæé†’ï¼ˆçº¢è‰²è­¦å‘Šï¼‰
- åˆ°æœŸå½“å¤©ï¼šæœåŠ¡é™çº§ä¸ºå…è´¹ç‰ˆ
```

### 2. è‡ªåŠ¨ç»­è´¹æœºåˆ¶
```javascript
// è‡ªåŠ¨ç»­è´¹é…ç½®
const autoRenewalConfig = {
  enabled: true,           // æ˜¯å¦å¼€å¯è‡ªåŠ¨ç»­è´¹
  advanceDays: 7,         // æå‰ç»­è´¹å¤©æ•°
  maxRetries: 3,          // æ”¯ä»˜å¤±è´¥é‡è¯•æ¬¡æ•°
  retryInterval: 24       // é‡è¯•é—´éš”ï¼ˆå°æ—¶ï¼‰
}

// è‡ªåŠ¨ç»­è´¹æ£€æŸ¥ï¼ˆæ¯æ—¥å®šæ—¶ä»»åŠ¡ï¼‰
async function checkAutoRenewal() {
  const subscriptions = await getExpiringSubscriptions(7); // 7å¤©å†…åˆ°æœŸ
  
  for (const sub of subscriptions) {
    if (sub.autoRenewal && !sub.renewalProcessed) {
      try {
        await processAutoRenewal(sub);
        await sendRenewalSuccessNotification(sub);
      } catch (error) {
        await handleRenewalFailure(sub, error);
      }
    }
  }
}
```

### 3. ç»­è´¹ä¼˜æƒ ç­–ç•¥
```
ç»­è´¹æ¿€åŠ±æ–¹æ¡ˆï¼š
- æå‰ç»­è´¹ï¼šæå‰30å¤©ç»­è´¹äº«å—9æŠ˜ä¼˜æƒ ï¼ˆ44å…ƒï¼‰
- è¿ç»­ç»­è´¹ï¼šè¿ç»­2å¹´ç”¨æˆ·äº«å—8.5æŠ˜ä¼˜æƒ ï¼ˆ42å…ƒï¼‰
- æ¨èå¥–åŠ±ï¼šæ¨èæ–°ç”¨æˆ·è´­ä¹°ï¼ŒåŒæ–¹å„è·å¾—1ä¸ªæœˆå…è´¹å»¶æœŸ
- å­¦ç”Ÿä¼˜æƒ ï¼šå­¦ç”Ÿè®¤è¯ç”¨æˆ·äº«å—7æŠ˜ä¼˜æƒ ï¼ˆ34å…ƒï¼‰
```

### 4. æ’ä»¶ç«¯ç»­è´¹æé†’
```javascript
// popup.js ä¸­æ·»åŠ ç»­è´¹çŠ¶æ€æ˜¾ç¤º
class PopupController {
  async updateSubscriptionStatus() {
    const subscription = await this.getSubscriptionInfo();
    const daysLeft = this.calculateDaysLeft(subscription.endDate);
    
    const statusElement = document.getElementById('subscriptionStatus');
    
    if (daysLeft <= 0) {
      // å·²è¿‡æœŸ
      statusElement.innerHTML = `
        <div class="status-expired">
          <span>âš ï¸ è®¢é˜…å·²è¿‡æœŸ</span>
          <button class="renew-btn">ç«‹å³ç»­è´¹</button>
        </div>
      `;
    } else if (daysLeft <= 7) {
      // å³å°†è¿‡æœŸ
      statusElement.innerHTML = `
        <div class="status-expiring">
          <span>â° ${daysLeft}å¤©ååˆ°æœŸ</span>
          <button class="renew-btn">ç»­è´¹äº«9æŠ˜</button>
        </div>
      `;
    } else if (daysLeft <= 30) {
      // æå‰æé†’
      statusElement.innerHTML = `
        <div class="status-reminder">
          <span>ğŸ“… ${daysLeft}å¤©ååˆ°æœŸ</span>
          <button class="renew-btn">æå‰ç»­è´¹</button>
        </div>
      `;
    } else {
      // æ­£å¸¸çŠ¶æ€
      statusElement.innerHTML = `
        <div class="status-active">
          <span>âœ… ä¸“ä¸šç‰ˆ (${daysLeft}å¤©)</span>
        </div>
      `;
    }
  }
}
```

### 5. ç»­è´¹æ•°æ®åº“è®¾è®¡
```javascript
// ç»­è´¹è®°å½•è¡¨
const RenewalSchema = {
  _id: ObjectId,
  userId: ObjectId,
  subscriptionId: ObjectId,
  renewalDate: Date,        // ç»­è´¹æ—¥æœŸ
  newEndDate: Date,         // æ–°çš„åˆ°æœŸæ—¥æœŸ
  amount: Number,           // ç»­è´¹é‡‘é¢
  discount: Number,         // æŠ˜æ‰£é‡‘é¢
  paymentMethod: String,    // æ”¯ä»˜æ–¹å¼
  autoRenewal: Boolean,     // æ˜¯å¦è‡ªåŠ¨ç»­è´¹
  status: String,           // 'success' | 'failed' | 'pending'
  createdAt: Date
}

// ç»­è´¹æé†’è®°å½•è¡¨
const ReminderSchema = {
  _id: ObjectId,
  userId: ObjectId,
  reminderType: String,     // '30days' | '15days' | '7days' | '3days'
  sentAt: Date,
  channel: String,          // 'email' | 'plugin' | 'sms'
  status: String            // 'sent' | 'failed'
}
```

### 6. ç»­è´¹å¤±è´¥å¤„ç†
```javascript
async function handleRenewalFailure(subscription, error) {
  // è®°å½•å¤±è´¥åŸå› 
  await logRenewalFailure(subscription.id, error);
  
  // å‘é€å¤±è´¥é€šçŸ¥
  await sendRenewalFailureNotification(subscription.userId, {
    reason: error.message,
    nextRetry: new Date(Date.now() + 24 * 60 * 60 * 1000),
    manualRenewalUrl: `https://zhiliuhuaxie.com/renew/${subscription.id}`
  });
  
  // å®‰æ’é‡è¯•
  if (subscription.retryCount < 3) {
    await scheduleRenewalRetry(subscription.id, subscription.retryCount + 1);
  } else {
    // é‡è¯•æ¬¡æ•°ç”¨å®Œï¼Œå‘é€æœ€ç»ˆé€šçŸ¥
    await sendFinalRenewalNotice(subscription.userId);
  }
}
```

### 7. ç”¨æˆ·ç»­è´¹ä½“éªŒä¼˜åŒ–
```
ç»­è´¹æµç¨‹ä¼˜åŒ–ï¼š
1. ä¸€é”®ç»­è´¹ï¼šç”¨æˆ·ä¸­å¿ƒæ˜¾è‘—ä½ç½®æ”¾ç½®ç»­è´¹æŒ‰é’®
2. ä»·æ ¼é€æ˜ï¼šæ¸…æ¥šæ˜¾ç¤ºåŸä»·ã€æŠ˜æ‰£ä»·ã€ä¼˜æƒ ä¿¡æ¯
3. æ”¯ä»˜ä¾¿æ·ï¼šæ”¯æŒå¾®ä¿¡ã€æ”¯ä»˜å®ã€é“¶è¡Œå¡å¤šç§æ–¹å¼
4. å³æ—¶ç”Ÿæ•ˆï¼šæ”¯ä»˜æˆåŠŸåç«‹å³å»¶é•¿æœåŠ¡æœŸé™
5. å‘ç¥¨æœåŠ¡ï¼šæ”¯æŒå¼€å…·ç”µå­å‘ç¥¨
6. å®¢æœæ”¯æŒï¼šç»­è´¹é—®é¢˜ä¸“é—¨å®¢æœé€šé“
```

### 8. ç»­è´¹è¥é”€ç­–ç•¥
```
è¥é”€æ—¶æœºï¼š
- ä½¿ç”¨é«˜å³°æœŸï¼šç”¨æˆ·é¢‘ç¹ä½¿ç”¨æ—¶æ¨é€ç»­è´¹ä¼˜æƒ 
- åŠŸèƒ½å‡çº§ï¼šæ–°åŠŸèƒ½å‘å¸ƒæ—¶æé†’ç»­è´¹äº«å—æ–°ç‰¹æ€§
- èŠ‚æ—¥ä¿ƒé”€ï¼šæ˜¥èŠ‚ã€åŒ11ç­‰èŠ‚æ—¥æ¨å‡ºç»­è´¹ä¼˜æƒ 
- ç”Ÿæ—¥ä¼˜æƒ ï¼šç”¨æˆ·æ³¨å†Œå‘¨å¹´æ—¥æ¨é€ä¸“å±ä¼˜æƒ 

è¥é”€æ¸ é“ï¼š
- æ’ä»¶å†…é€šçŸ¥ï¼šæœ€ç›´æ¥çš„è§¦è¾¾æ–¹å¼
- é‚®ä»¶è¥é”€ï¼šè¯¦ç»†çš„ç»­è´¹è¯´æ˜å’Œä¼˜æƒ ä¿¡æ¯
- å¾®ä¿¡å…¬ä¼—å·ï¼šæ¨é€ç»­è´¹æé†’å’Œä¼˜æƒ æ´»åŠ¨
- çŸ­ä¿¡é€šçŸ¥ï¼šé‡è¦çš„åˆ°æœŸæé†’
```

### 9. ç»­è´¹æ•°æ®åˆ†æ
```
å…³é”®æŒ‡æ ‡ç›‘æ§ï¼š
- ç»­è´¹ç‡ï¼šæœˆåº¦/å¹´åº¦ç»­è´¹ç‡ç»Ÿè®¡
- æµå¤±åˆ†æï¼šç”¨æˆ·æµå¤±åŸå› å’Œæ—¶é—´ç‚¹åˆ†æ
- ä»·æ ¼æ•æ„Ÿåº¦ï¼šä¸åŒä»·æ ¼ç­–ç•¥çš„ç»­è´¹æ•ˆæœ
- æé†’æ•ˆæœï¼šå„ç§æé†’æ–¹å¼çš„è½¬åŒ–ç‡
- ä¼˜æƒ æ•ˆæœï¼šä¸åŒä¼˜æƒ ç­–ç•¥çš„ç»­è´¹ä¿ƒè¿›æ•ˆæœ
```

---

## ğŸ“Š è¿è¥ç­–ç•¥

### 1. æ¨å¹¿ç­–ç•¥
```
- SEOä¼˜åŒ–ï¼šå…³é”®è¯"æ“ä½œå½•åˆ¶"ã€"æ–‡æ¡£ç”Ÿæˆ"ã€"Chromeæ’ä»¶"
- å†…å®¹è¥é”€ï¼šæŠ€æœ¯åšå®¢ã€ä½¿ç”¨æ•™ç¨‹ã€æ¡ˆä¾‹åˆ†äº«
- ç¤¾äº¤åª’ä½“ï¼šå¾®ä¿¡å…¬ä¼—å·ã€çŸ¥ä¹ã€Bç«™æ•™ç¨‹è§†é¢‘
- åˆä½œæ¨å¹¿ï¼šä¸ä¼ä¸šåŸ¹è®­æœºæ„ã€SaaSå¹³å°åˆä½œ
```

### 2. ç”¨æˆ·å¢é•¿
```
- å…è´¹è¯•ç”¨ï¼š20é¡µé™åˆ¶å¸å¼•ç”¨æˆ·ä½“éªŒ
- æ¨èå¥–åŠ±ï¼šæ¨èå¥½å‹è·å¾—å»¶é•¿è¯•ç”¨
- ä¼ä¸šç‰ˆæœ¬ï¼šé’ˆå¯¹å›¢é˜Ÿç”¨æˆ·çš„æ‰¹é‡æˆæƒ
- åŠŸèƒ½è¿­ä»£ï¼šæ ¹æ®ç”¨æˆ·åé¦ˆæŒç»­ä¼˜åŒ–
```

### 3. æ•°æ®åˆ†æ
```
- ç”¨æˆ·è¡Œä¸ºï¼šä½¿ç”¨é¢‘ç‡ã€åŠŸèƒ½åå¥½ã€è½¬åŒ–è·¯å¾„
- æ”¶å…¥åˆ†æï¼šæœˆåº¦æ”¶å…¥ã€ç”¨æˆ·ç”Ÿå‘½å‘¨æœŸä»·å€¼
- äº§å“ä¼˜åŒ–ï¼šåŠŸèƒ½ä½¿ç”¨ç‡ã€ç”¨æˆ·åé¦ˆåˆ†æ
```

---

## ğŸš€ å®æ–½è®¡åˆ’

### ç¬¬ä¸€é˜¶æ®µï¼ˆ1-2å‘¨ï¼‰
- [ ] ç½‘ç«™å‰ç«¯å¼€å‘
- [ ] ç”¨æˆ·ç³»ç»Ÿæ­å»º
- [ ] å¾®ä¿¡ç™»å½•é›†æˆ
- [ ] æ”¯ä»˜ç³»ç»Ÿå¯¹æ¥

### ç¬¬äºŒé˜¶æ®µï¼ˆ2-3å‘¨ï¼‰
- [ ] æ’ä»¶æˆæƒæ”¹é€ 
- [ ] APIæ¥å£å¼€å‘
- [ ] æ•°æ®åº“è®¾è®¡å®ç°
- [ ] æµ‹è¯•ç¯å¢ƒéƒ¨ç½²

### ç¬¬ä¸‰é˜¶æ®µï¼ˆ1å‘¨ï¼‰
- [ ] å…¨é¢æµ‹è¯•
- [ ] æ€§èƒ½ä¼˜åŒ–
- [ ] å®‰å…¨æ£€æŸ¥
- [ ] æ­£å¼ä¸Šçº¿

### ç¬¬å››é˜¶æ®µï¼ˆæŒç»­ï¼‰
- [ ] ç”¨æˆ·åé¦ˆæ”¶é›†
- [ ] åŠŸèƒ½è¿­ä»£ä¼˜åŒ–
- [ ] å¸‚åœºæ¨å¹¿
- [ ] æ•°æ®åˆ†æä¼˜åŒ–

---

## ğŸ’° æˆæœ¬é¢„ç®—

### å¼€å‘æˆæœ¬
- å‰ç«¯å¼€å‘ï¼š15,000å…ƒ
- åç«¯å¼€å‘ï¼š20,000å…ƒ
- UIè®¾è®¡ï¼š8,000å…ƒ
- æµ‹è¯•éƒ¨ç½²ï¼š5,000å…ƒ
- **æ€»è®¡ï¼š48,000å…ƒ**

### è¿è¥æˆæœ¬ï¼ˆå¹´ï¼‰
- æœåŠ¡å™¨è´¹ç”¨ï¼š3,600å…ƒ/å¹´
- åŸŸåSSLï¼š500å…ƒ/å¹´
- å¾®ä¿¡æ”¯ä»˜è´¹ç‡ï¼š0.6%
- æ¨å¹¿è´¹ç”¨ï¼š10,000å…ƒ/å¹´
- **æ€»è®¡ï¼šçº¦14,100å…ƒ/å¹´**

### æ”¶ç›Šé¢„æµ‹ï¼ˆè€ƒè™‘ç»­è´¹ï¼‰
**ç¬¬ä¸€å¹´**ï¼š
- æ–°å¢ä»˜è´¹ç”¨æˆ·ï¼š1000ä¸ª
- å¹´æ”¶å…¥ï¼š49,000å…ƒ
- å‡€åˆ©æ¶¦ï¼šçº¦35,000å…ƒ

**ç¬¬äºŒå¹´**ï¼ˆå‡è®¾70%ç»­è´¹ç‡ï¼‰ï¼š
- ç»­è´¹ç”¨æˆ·ï¼š700ä¸ª Ã— 49å…ƒ = 34,300å…ƒ
- æ–°å¢ç”¨æˆ·ï¼š500ä¸ª Ã— 49å…ƒ = 24,500å…ƒ
- æ€»æ”¶å…¥ï¼š58,800å…ƒ
- å‡€åˆ©æ¶¦ï¼šçº¦44,700å…ƒ

**ç¬¬ä¸‰å¹´**ï¼ˆå‡è®¾75%ç»­è´¹ç‡ï¼‰ï¼š
- ç»­è´¹ç”¨æˆ·ï¼š900ä¸ª Ã— 49å…ƒ = 44,100å…ƒ
- æ–°å¢ç”¨æˆ·ï¼š300ä¸ª Ã— 49å…ƒ = 14,700å…ƒ
- æ€»æ”¶å…¥ï¼š58,800å…ƒ
- å‡€åˆ©æ¶¦ï¼šçº¦44,700å…ƒ

**ç»­è´¹ç‡æå‡ç­–ç•¥**ï¼š
- ç›®æ ‡ç»­è´¹ç‡ï¼šç¬¬ä¸€å¹´70% â†’ ç¬¬äºŒå¹´75% â†’ ç¬¬ä¸‰å¹´80%
- å…³é”®æªæ–½ï¼šä¼˜è´¨æœåŠ¡ã€åŠŸèƒ½è¿­ä»£ã€ç”¨æˆ·ç²˜æ€§æå‡
- é•¿æœŸä»·å€¼ï¼šå•ä¸ªç”¨æˆ·LTVçº¦147å…ƒï¼ˆ3å¹´å¹³å‡ï¼‰

---

## ğŸ“ è”ç³»æ–¹å¼

å¦‚éœ€è¯¦ç»†çš„æŠ€æœ¯å®ç°æ–¹æ¡ˆæˆ–æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·è”ç³»ï¼š
- é‚®ç®±ï¼šcontact@zhiliuhuaxie.com
- å¾®ä¿¡ï¼šzhiliuhuaxie
- å®˜ç½‘ï¼šhttps://zhiliuhuaxie.com

---

*æœ¬è®¾è®¡æ–¹æ¡ˆä¸ºæ™ºæµåå†™æ’ä»¶å•†ä¸šåŒ–çš„å®Œæ•´è§£å†³æ–¹æ¡ˆï¼Œæ¶µç›–äº†ä»äº§å“å®šä½åˆ°æŠ€æœ¯å®ç°çš„æ‰€æœ‰å…³é”®ç¯èŠ‚ã€‚*